# Settings to manage and configure a Firebase App Hosting backend.
# https://firebase.google.com/docs/app-hosting/configure

buildConfig:
  buildCommand: |
    set -e
    echo "Cleaning up..."
    rm -f package-lock.json npm-shrinkwrap.json || true
    echo "Installing dependencies..."
    npm install --legacy-peer-deps --no-optional --no-audit --no-fund --loglevel=error --no-save --package-lock=false --no-package-lock || npm install --legacy-peer-deps --no-optional --no-audit --no-fund --loglevel=error
    echo "Building application..."
    NODE_OPTIONS="--max-old-space-size=6144" npm run build
  outputDirectory: .next
  environmentVariables:
    NODE_ENV: production
    NEXT_TELEMETRY_DISABLED: 1
    SKIP_ENV_VALIDATION: true
    NODE_OPTIONS: "--max-old-space-size=6144"
    CI: "false"
    BUILDKIT_PROGRESS: "plain"
    SKIP_REQUIRE_BUILD: "false"
    npm_config_package_lock: "false"
    npm_config_shrinkwrap: "false"

runConfig:
  # Increase this value if you'd like to automatically spin up
  # more instances in response to increased traffic.
  maxInstances: 1
  # Node.js version
  runtime: nodejs18