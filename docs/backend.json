
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the StudioZen application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "The display name of the user."
        },
        "birthDate": {
          "type": "string",
          "description": "The user's date of birth.",
          "format": "date"
        },
        "country": {
          "type": "string",
          "description": "The user's country of origin."
        },
        "schoolType": {
          "type": "string",
          "description": "The user's type of school (e.g., high school, university).",
          "enum": ["middle-school", "high-school", "university", "other"]
        },
        "learningStyle": {
            "type": "string",
            "description": "The user's preferred learning style, used to tailor AI-generated content.",
            "enum": ["standard", "simplified"]
        }
      },
      "required": [
        "id",
        "email",
        "name"
      ]
    },
    "FocusSession": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FocusSession",
      "type": "object",
      "description": "Represents a focus session using the Pomodoro timer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the FocusSession entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N FocusSession)"
        },
        "startTime": {
          "type": "string",
          "description": "The start time of the focus session. (date-time format)",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "description": "The end time of the focus session. (date-time format)",
          "format": "date-time"
        },
        "duration": {
          "type": "number",
          "description": "The duration of the focus session in minutes."
        },
        "interruptionCount": {
          "type": "number",
          "description": "The number of times the user was interrupted during the focus session."
        }
      },
      "required": [
        "id",
        "userId",
        "startTime",
        "endTime",
        "duration"
      ]
    },
    "Chat": {
      "title": "Chat",
      "type": "object",
      "description": "Represents a single chat conversation thread.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the Chat entity." },
        "userId": { "type": "string", "description": "ID of the user who owns the chat." },
        "title": { "type": "string", "description": "The title of the chat session." },
        "createdAt": { "type": "string", "description": "Timestamp of when the chat was created.", "format": "date-time" }
      },
      "required": ["id", "userId", "title", "createdAt"]
    },
    "ChatMessage": {
        "title": "ChatMessage",
        "type": "object",
        "description": "Represents a single message within a chat conversation.",
        "properties": {
            "id": { "type": "string", "description": "Unique identifier for the ChatMessage entity." },
            "chatId": { "type": "string", "description": "ID of the chat this message belongs to." },
            "role": { "type": "string", "description": "The role of the message sender (e.g., 'user', 'model').", "enum": ["user", "model"] },
            "content": { "type": "string", "description": "The text content of the message." },
            "createdAt": { "type": "string", "description": "Timestamp of when the message was sent.", "format": "date-time" }
        },
        "required": ["id", "chatId", "role", "content", "createdAt"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/focusSessions/{focusSessionId}",
        "definition": {
          "entityName": "FocusSession",
          "schema": {
            "$ref": "#/backend/entities/FocusSession"
          },
          "description": "Stores focus session data for each user. Path-based ownership ensures only the user can access their focus session data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "focusSessionId",
              "description": "The unique identifier of the focus session."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/chats/{chatId}",
        "definition": {
          "entityName": "Chat",
          "schema": {
            "$ref": "#/backend/entities/Chat"
          },
          "description": "Stores individual chat conversation threads for each user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "chatId",
              "description": "The unique identifier of the chat."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/chats/{chatId}/messages/{messageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": {
            "$ref": "#/backend/entities/ChatMessage"
          },
          "description": "Stores all messages for a specific chat conversation. Nested to ensure data ownership and simplify security rules.",
          "params": [
             {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "chatId",
              "description": "The unique identifier of the chat."
            },
            {
                "name": "messageId",
                "description": "The unique identifier of the message."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure secure and scalable data management for the StudioZen application, focusing on authorization independence and clear data ownership. User-specific data (FocusSessions, Chats, ChatMessages) is stored under path-based ownership (`/users/{userId}/...`), ensuring only the owning user can access their data. This structure avoids the need for complex security rules that require reading parent documents, thus enabling atomic operations. FocusSession, Chat, and ChatMessage entities will exist as subcollections of user documents to ensure that the authenticated user has access to this information. This approach achieves authorization independence by leveraging the inherent path-based ownership in Firestore, which simplifies security rules and enhances performance. The use of dedicated subcollections ensures that each collection maintains a homogeneous security posture, streamlining rule definitions and improving debuggability."
  }
}
